
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
<head><meta name="description" content="The basic tutorial creates a pipeline that processes data in two branches and writes all data to the destination. You'll use data prevew to help configure the pipeline, and you'll create a data alert ..."></meta><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><meta name="copyright" content="(C) Copyright 2005"></meta><meta name="DC.rights.owner" content="(C) Copyright 2005"></meta><meta name="DC.Type" content="concept"></meta><meta name="DC.Title" content="Basic Tutorial"></meta><meta name="abstract" content="The basic tutorial creates a pipeline that processes data in two branches and writes all data to the destination. You'll use data prevew to help configure the pipeline, and you'll create a data alert and run the pipeline."></meta><meta name="description" content="The basic tutorial creates a pipeline that processes data in two branches and writes all data to the destination. You'll use data prevew to help configure the pipeline, and you'll create a data alert and run the pipeline."></meta><meta name="DC.Relation" scheme="URI" content="../Tutorial/Tutorial-title.html"></meta><meta name="DC.Format" content="XHTML"></meta><meta name="DC.Identifier" content="concept_phf_cjt_ls"></meta><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/commonltr.css"><!----></link><title>Basic Tutorial</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="../oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><link rel="stylesheet" type="text/css" href="../skin.css"></link><script type="text/javascript"><!--
          
          var prefix = "../index.html";
          
          --></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-1.8.2.min.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery.cookie.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery-ui.custom.min.js"><!----></script><script type="text/javascript" src="../oxygen-webhelp/resources/js/jquery.highlight-3.js"><!----></script><script type="text/javascript" charset="utf-8" src="../oxygen-webhelp/resources/js/webhelp_topic.js"><!----></script></head>
<body onload="highlightSearchTerm()" class="frmBody">
<table class="nav"><tbody><tr><td colspan="2"><div id="printlink"><a href="javascript:window.print();" title="Print this page"></a></div><div id="permalink"><a href="#" title="Link to this page"></a></div></td></tr><tr><td width="75%"><a class="navheader_parent_path" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial">Data Collector Tutorial</a></td><td><div class="navheader">
<span class="navparent"><a class="link" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Data Collector Tutorial</span></a></span>  </div></td></tr></tbody></table>
<div class="nested0" id="concept_phf_cjt_ls">
 <h1 class="title topictitle1">Basic Tutorial</h1>

 
 <div class="body conbody"><p class="shortdesc">The basic tutorial creates a pipeline that processes data in two branches and writes all
  data to the destination. You'll use data prevew to help configure the pipeline, and you'll create
  a data alert and run the pipeline. </p>

  <div class="p">Here are high level steps for
   building and running the basic pipeline:<ol class="ol" id="concept_phf_cjt_ls__ol_emy_rhp_ms">
    <li class="li">Configure pipeline properties, primarily error handling.</li>

    <li class="li">Add a Directory origin to represent the data to be processed. </li>

    <li class="li">Preview source data to determine the field-level details needed for the pipeline.</li>

    <li class="li">Use a Stream Selector processor to route credit card transactions to the primary branch and
     cash transactions to the secondary branch. We'll define a required field to discard records
     without a payment type.</li>

    <li class="li">Configure a Jython Evaluator to perform custom processing that determines the credit card
     type based on the credit card number. </li>

    <li class="li">Add a Field Masker to mask credit card numbers. Use a required field to discard records
     without credit card numbers.</li>

    <li class="li">In the secondary branch, use an Expression Evaluator to add fields to the cash records to
     match the credit card records. Use data preview to verify the fields to add. </li>

    <li class="li">Connect both branches to a Hadoop FS destination.</li>

    <li class="li">Add a data rule to raise an alert if too many credit card payments are missing credit card
     numbers.</li>

    <li class="li">Start the pipeline and monitor the results.</li>

   </ol>
</div>

  
 </div>

<div class="related-links"></div>
<div class="topic task nested1" id="task_jmz_3dn_ls">
    <h2 class="title topictitle2">Creating a Pipeline and Defining Pipeline Properties</h2>

    
    <div class="body taskbody"><p class="shortdesc">When you configure a pipeline, you need to decide what to do with error records. You
        can discard them, write them to file, or write them to Kafka. </p>

        <div class="section context">
            <p class="p">This tutorial writes the records to a local file, but if you prefer to write error
                records to Kafka, feel free. </p>

        </div>

        <ol class="ol steps" id="task_jmz_3dn_ls__steps_hsz_b2n_ls"><li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="keyword wintitle">Error Records</span> tab, for the <span class="ph uicontrol">Error
                        Records</span> property, select <span class="ph uicontrol">Write to
                    File</span>.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="keyword wintitle">Error Records - Write to File</span> tab and configure
                    the following properties: </span>
                <div class="itemgroup info">
                    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="task_jmz_3dn_ls__table_zvy_kfn_ls" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" width="27.47252747252747%" id="d46622e126">Write to File Property</th>

                                    <th class="entry" valign="top" width="72.52747252747253%" id="d46622e129">Description</th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                                <tr class="row">
                                    <td class="entry" valign="top" width="27.47252747252747%" headers="d46622e126 ">Directory</td>

                                    <td class="entry" valign="top" width="72.52747252747253%" headers="d46622e129 ">Enter the directory local to the <span class="ph">Data
                  Collector</span> where you want to write error record files. <div class="note note"><span class="notetitle">Note:</span> To
                                            prevent validation errors, the directory must already
                                            exist.</div>
</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="27.47252747252747%" headers="d46622e126 ">Files Prefix</td>

                                    <td class="entry" valign="top" width="72.52747252747253%" headers="d46622e129 ">This defines a prefix for error record files. <p class="p">By default, the files are prefixed with "SDC" and an expression that
                  returns the <span class="ph">Data
                  Collector</span> ID, but that's more than
                  we need here. </p>
<p class="p">Delete the default and enter "Err_".</p>
</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="27.47252747252747%" headers="d46622e126 ">Max File Size</td>

                                    <td class="entry" valign="top" width="72.52747252747253%" headers="d46622e129 ">When writing to a local directory, you might want to
                                        reduce the files size to something more managable, such as 5
                                        or 1 MB.</td>

                                </tr>

                            </tbody>

                        </table>
</div>

                </div>
            </li>
</ol>

    </div>

</div>
<div class="topic task nested1" id="task_ftt_2vq_ks">
    <h2 class="title topictitle2">Configure the Origin</h2>

    
    <div class="body taskbody"><p class="shortdesc">The origin represents the source data for the pipeline. When you configure the
        origin, you define how to connect to the data, and the type of data to be processed. </p>

        <div class="section context">
            <p class="p">To process data in a static file, we'll use the Directory origin.</p>

        </div>

        <ol class="ol steps" id="task_ftt_2vq_ks__steps_ckz_gvq_ks"><li class="li step stepexpand">
                <span class="ph cmd">To add the stage to the canvas, in the Stage list, click the
                        <span class="ph uicontrol">Directory</span> origin. Or, from the Pipeline Creation Help
                    Bar, click <span class="ph menucascade"><span class="ph uicontrol">Select Origin</span> &gt; <span class="ph uicontrol">Directory</span></span>.</span>
                <div class="itemgroup info">The origin displays in the canvas and the Properties panel displays the stage
                    properties. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the Properties panel, click the <span class="keyword wintitle">Files</span> tab and configure
                    the following properties - use defaults for all other properties:</span>
                <div class="itemgroup info">
                    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="task_ftt_2vq_ks__table_w5c_jyq_ks" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" width="35.97122302158273%" id="d46622e246">Directory Property</th>

                                    <th class="entry" valign="top" width="64.02877697841726%" id="d46622e249">Value</th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                                <tr class="row">
                                    <td class="entry" valign="top" width="35.97122302158273%" headers="d46622e246 ">Data Format</td>

                                    <td class="entry" valign="top" width="64.02877697841726%" headers="d46622e249 ">Delimited.</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="35.97122302158273%" headers="d46622e246 ">Files Directory</td>

                                    <td class="entry" valign="top" width="64.02877697841726%" headers="d46622e249 ">Enter the local directory where you saved the source
                                        file. </td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="35.97122302158273%" headers="d46622e246 ">File Name Pattern</td>

                                    <td class="entry" valign="top" width="64.02877697841726%" headers="d46622e249 ">If the file is the only file in the directory, you can
                                        use the asterisk wild card (*) or something similarly
                                        generic, like *.csv.</td>

                                </tr>

                            </tbody>

                        </table>
</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">For delimited data, additional properties are available, so click the
                        <span class="keyword wintitle">Delimited</span> tab. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">The sample data includes a header row, so set the <span class="ph uicontrol">Header
                        Line</span> property to <span class="ph uicontrol">With Header Line</span>.</span>
            </li>
</ol>

        <div class="section result">This is how the stage and pipeline should look at this point:<p class="p"><img class="image" id="task_ftt_2vq_ks__image_kj1_c5f_4s" src="../Graphics/Tutorial-Directory.png" height="452" width="796"></img></p>
<p class="p">Notice the error icons on the page. If you click the Issues icon or hover
                over the Directory error icon, you see a warning that the origin isn't connected to
                anything yet. All in good time. </p>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_xb5_2sf_4s">
    <h2 class="title topictitle2">Preview Data </h2>

    
    <div class="body taskbody"><p class="shortdesc">Let's preview the source data to become more familiar with the data set and gather
        some details for pipeline configuration. </p>

        <div class="section context">
            <div class="p"> This is the information we need: <ul class="ul" id="task_xb5_2sf_4s__ul_a41_hvh_4s">
                    <li class="li">The name and field path of the field that contains payment information -
                        We'll use this to route data in the Stream Selector. </li>

                    <li class="li">The field path for credit card numbers - We'll use this to mask the data in
                        the Field Masker.</li>

                </ul>
</div>

            <p class="p">The format for field paths differs based on the type of data you're working with. In
                short, when working with a simple JSON object or record, you'd reference a field
                path as follows: <samp class="ph codeph">/&lt;fieldname&gt;</samp>. </p>

            <p class="p">But for a delimited record, a field path includes the index and path to the field as
                follows: <samp class="ph codeph">[index number]/&lt;path to field&gt;</samp>. </p>

            <p class="p">You'll see what we mean as we go through the tutorial. But if you'd like some extra
                reading, you can find some details here: <a class="xref" href="../Pipeline_Configuration/Expressions.html#concept_hjk_b4l_vq" title="When a pipeline is valid for preview, you can generally select fields from a list. When a list is not available or when you are defining a new field name, you need to use the appropriate format for the field name.">Referencing Field Names and Field Paths</a>
                or <a class="xref" href="../Pipeline_Configuration/PipelineDesign.html#concept_zcg_bm4_fs" title="When reading delimited data, the Data Collector converts each row of delimited data to a record in List data format. To perform additional processing on the record, you can use the general expression language with your knowledge of the resulting record format or you can use delimited data functions.">Delimited Data Record Structure</a>.</p>

            <p class="p">To start data preview, all stages must be connected and all required fields filled
                (though not necessarily correctly). Since the origin is configured and the only
                stage, the pipeline should be ready to preview as is. </p>

        </div>

        <ol class="ol steps" id="task_xb5_2sf_4s__steps_jxv_fpf_4s"><li class="li step stepexpand">
                <span class="ph cmd">Above the pipeline canvas, click the <span class="ph uicontrol">Preview</span> icon:
                        <img class="image" id="task_xb5_2sf_4s__image_x4k_njp_rs" src="../Graphics/icon_Preview.png" height="13" width="17"></img>.</span>
                <div class="itemgroup info">If the icon is not enabled, make sure you completed all the previous steps for
                    the tutorial. If more than one issue displays in the list, correct any issue
                    except Validation_0011 for the unconnected Directory stage. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the <span class="keyword wintitle">Preview Configuration</span> dialog box, select
                        <span class="ph uicontrol"> Remember the Configuration</span> and make sure
                        <span class="ph uicontrol">Write to Destinations</span> is not selected.</span>
                <div class="itemgroup info">This current configuration ensures that data preview uses data from the source
                    file, displays 10 records, and avoids writing preview data to the destination. </div>
                <div class="itemgroup info">Selecting Remember the Configuration means that the next time you click the
                    Data Preview icon, the data preview uses the configured settings without
                    displaying this dialog box again. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click <span class="ph uicontrol">Run Preview</span>.</span>
                <div class="itemgroup stepresult">The Preview Panel displays a list of 10 output records for Directory in
                    list view. If you drill down a bit, you see that the delimited record data
                    structure is a list with a maps, and each map includes a header and value.
                        <p class="p">Note that in the Preview panel, the preview records display on the
                        Records tab. You can click the Client Configuration tab to review or change
                        properties. You can click the Preview Configuration tab to change preview
                        properties.</p>
</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">For a full view of the data, click the <span class="ph uicontrol">Table View</span> icon:
                        <img class="image" id="task_xb5_2sf_4s__image_zxq_1zf_4s" src="../Graphics/icon_PrevTableView.png" height="12" width="16"></img>.</span>
                <div class="itemgroup info">The Preview panel displays the first several columns of data. <p class="p"><img class="image" id="task_xb5_2sf_4s__image_d1m_yzf_4s" src="../Graphics/Tutorial-PreviewDirectory.png" height="338" width="695"></img></p>
</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To view all columns, click <span class="ph uicontrol">Show All</span>.</span>
                <div class="itemgroup info">If you scroll to the right, you can verify that the credit_card field contains
                    credit card numbers for the first three records. When you scroll back to the
                    left, notice this corresponds to "CRD" in the payment_type field. </div>
                <div class="itemgroup info">Now we know that to route records paid by credit card, we should look for
                    records where the payment_type field = "CRD".</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To check the field path for this field, click the List icon: <img class="image" id="task_xb5_2sf_4s__image_hq1_hrg_4s" src="../Graphics/icon_PrevListView.png" height="12" width="16"></img>.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the arrow by the first record to display the list of maps in the record.
                    The payment_type field was the fourth field, so click the arrow by index number
                    3. </span>
                <div class="itemgroup info"><img class="image" id="task_xb5_2sf_4s__image_ujw_rwh_4s" src="../Graphics/Tutorial-PreviewList.png" height="175" width="656"></img></div>
                <div class="itemgroup info">From this information, we know to reference the data in the payment_type field
                    as follows: <samp class="ph codeph">[3]/value</samp>.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">The credit_card field was the last in the record, so scroll down and click the
                    arrow by the last map, number 20. </span>
                <div class="itemgroup info">Notice, the index number is 20, and the field name for the value is "value".
                    So to access this data, we'll use the following field path:
                        <samp class="ph codeph">[20]/value</samp>.</div>
                <div class="itemgroup info">As mentioned earlier, working with delimited data presents specific challenges
                    like these. If this were a field in a database table or a simple JSON record,
                    the field path could have been: <samp class="ph codeph">/credit_card</samp>. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Now that we have the information that we need, click the <span class="ph uicontrol">Close
                        Preview</span> icon: <img class="image" id="task_xb5_2sf_4s__image_zs2_2bg_4s" src="../Graphics/icon_PrevClose.png" height="13" width="16"></img>.</span>
            </li>
</ol>

        <div class="section result">To summarize, here are the details that we discovered with data preview: <ul class="ul" id="task_xb5_2sf_4s__ul_rhp_gx3_ps">
                <li class="li">The header for the field that contains payment type information is
                    payment_type.</li>

                <li class="li">The field path for the payment type data is <samp class="ph codeph">[3]/value</samp>.</li>

                <li class="li">The field path for credit card numbers is <samp class="ph codeph">[20]/value</samp>.</li>

            </ul>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_br5_rzq_ks">
    <h2 class="title topictitle2">Route Data with the Stream Selector</h2>

    
    <div class="body taskbody"><p class="shortdesc">To route records credit card transactions to a separate branch for processing, we use
        the Stream Selector processor. We'll also define a required field to drop records with no
        payment type. </p>

        <div class="section context"><p class="p">When you defined a required field, a record must include data for the specified
                field to enter the stage. Records that don't meet the requirement are sent to the
                pipeline for error handling. If you configured the pipeline to write to file, that's
                where the error records go. </p>
<p class="p">The Stream Selector uses user-defined conditions
                to route data. Any data not captured by a user-defined condition routes to the
                default stream. </p>
Because the data is delimited, we use a delimited data record
            function for the condition. The <samp class="ph codeph">record:dValue</samp> function returns the
            value associated with the specified header so you don't need to know the exact index
            position of the header in the record. <div class="p">To capture records with credit card payments,
                use the following condition:
                <pre class="pre codeblock">${record:dValue('payment_type') == 'CRD'}</pre>
</div>
<p class="p">Enclose
                expressions in a dollar sign and curly brackets, as shown. For more information
                about the expression language, see <a class="xref" href="../Expression_Language/ExpressionLanguage_overview.html#concept_p54_4kl_vq">Expression Language</a>.</p>
</div>

        <ol class="ol steps" id="task_br5_rzq_ks__steps_xhx_3rk_ls"><li class="li step stepexpand">
                <span class="ph cmd">In the stage library, select the <span class="ph uicontrol">Stream Selector</span>
                    processor and connect it to the pipeline. Or, from the Pipeline Creation Help
                    Bar, click <span class="ph menucascade"><span class="ph uicontrol">Select Processor to Connect</span> &gt; <span class="ph uicontrol">Stream Selector</span></span>.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">On the <span class="keyword wintitle">General</span> tab, click in the <span class="ph uicontrol">Required
                        Fields</span> text box. </span>
                <div class="itemgroup info">A list of available fields displays because you've already performed data
                    preview. It also displays when the pipeline is valid for data preview. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To discard records with no payment type information, select the following
                    field: <span class="ph uicontrol">[3]/value</span>.</span>
                <div class="itemgroup info">If a list does not appear, you can manually enter the field path:
                    [3]/value.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">With the Stream Selector selected, in the Properties panel, click the
                        <span class="ph uicontrol">Conditions</span> tab.</span>
                <div class="itemgroup info">A default condition for the default stream displays. The default stream
                    represents any records not captured by other conditions.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="ph uicontrol">Add</span> icon.</span>
                <div class="itemgroup info">A condition text box displays in the Property panel, and the corresponding
                    output location appears on the stage in the canvas.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Enter the following condition to capture records where a credit card is used
                    for payment:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock">${record:dValue('payment_type') == 'CRD'}</pre>

                </div>
                <div class="itemgroup info">You can use single quotation marks or regular quotation marks around the
                    string values. </div>
                <div class="itemgroup info">All other records are captured by the default condition and stream.</div>
            </li>
</ol>

        <div class="section result">The Stream Selector should look like this:<p class="p"><img class="image" id="task_br5_rzq_ks__image_t1s_png_4s" src="../Graphics/Tutorial-StreamSelector.png" height="332" width="751"></img></p>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_cdx_kfm_ls">
    <h2 class="title topictitle2">Use Jython for Card Typing</h2>

    
    <div class="body taskbody"><p class="shortdesc"> Next, we'll evaluate credit card numbers to determine the credit card type. You can
        use an Expression Evaluator to do the same calculations, but with the a short script, the
        Jython Evaluator is easier.</p>

        <div class="section context">
            <p class="p">The <span class="ph">Data
                  Collector</span> provides the JavaScript Evaluator and the Jython Evaluator so you can use custom
                scripts to perform processing that is not easily performed using other <span class="ph">Data
                  Collector</span> processors.</p>

            <p class="p">The Jython script that we'll use creates an additional field, credit_card_type, and
                generates the credit card type based on the first few digits of the credit card
                number. The script returns an error message if the record has a credit card payment
                type without a corresponding credit card number. </p>

        </div>

        <ol class="ol steps" id="task_cdx_kfm_ls__steps_lnv_lfm_ls"><li class="li step stepexpand">
                <span class="ph cmd">Add a <span class="ph uicontrol">Jython Evaluator</span> processor to the canvas and
                    connect it to the first output location of the Stream Selector.</span>
                <div class="itemgroup info">This routes records paid by credit card to the Jython Evaluator. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">With the Jython Evaluator selected, in the Properties panel, click the
                        <span class="keyword wintitle">Jython</span> tab. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Use the default record processing mode to process data in batches, instead of
                    record by record. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the <span class="ph uicontrol">Script</span> text box, delete everything below the
                    first set of comments, and then paste the following script: </span>
                <div class="itemgroup info">
                    <pre class="pre codeblock">try: 
  for record in records:
    cc = record.value[20]['value']
    if cc == '':
      err.write(record, "Payment type was CRD, but credit card was null")
      continue

    cc_type = ''
    if cc.startswith('4'):
      cc_type = 'Visa'
    elif cc.startswith(('51','52','53','54','55')):
      cc_type = 'MasterCard'
    elif cc.startswith(('34','37')):
      cc_type = 'AMEX'
    elif cc.startswith(('300','301','302','303','304','305','36','38')):
      cc_type = 'Diners Club'
    elif cc.startswith(('6011','65')):
      cc_type = 'Discover'
    elif cc.startswith(('2131','1800','35')):
      cc_type = 'JCB'
    else:
      cc_type = 'Other'

    record.value.append({'header':'credit_card_type','value':cc_type})
    out.write(record)
except Exception as e:
  err.write(record, e.message)</pre>

                    <div class="note note"><span class="notetitle">Note:</span> Incorrect indentation can cause
                  Jython validation errors. Copying the script from the PDF can cause incorrect
                  indentation. For best results, copy the script from the online help: online help &gt;
                  Data Collector Tutorial &gt; Extended Tutorial &gt; Flatten Data with a Jython
                  Evaluator. </div>

                </div>
            </li>
</ol>

        <div class="section result">In the Jython Evaluator, the script should look like this:<p class="p"><img class="image" id="task_cdx_kfm_ls__image_jt1_4ch_4s" src="../Graphics/Tutorial-Jython.png" height="463" width="657"></img></p>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_qbw_d3m_ls">
    <h2 class="title topictitle2">Mask Credit Card Numbers</h2>

    
    <div class="body taskbody"><p class="shortdesc">Now we've evaluated the credit card type, let's use a Field Masker to mask the credit
        card numbers. </p>

        <div class="section context">
            <p class="p">The Field Masker provides fixed and variable-length masks to mask all data. You can
                create a custom mask - a static mask that can reveal positions. And you can use a
                regular expression mask to define the string to be masked and optionally reveal one
                or more groups in the string.</p>

            <div class="p">For the credit card numbers, we'll use the following regular expression to mask all
                but the last four digits:<pre class="pre codeblock">(.*)([0-9]{4})</pre>
</div>

            <p class="p">The regular expression defines two groups so we can reveal the second group.</p>

        </div>

        <ol class="ol steps" id="task_qbw_d3m_ls__steps_wwy_fjm_ls"><li class="li step stepexpand">
                <span class="ph cmd">Add a <span class="ph uicontrol">Field Masker</span> processor to the canvas and connect
                    it to the Jython Evaluator. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the Properties panel, click the <span class="keyword wintitle">Mask</span> tab.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click in the <span class="ph uicontrol">Fields to Mask</span> field. Scroll down the list
                    of fields and select the field that represents credit card data:
                        <span class="ph uicontrol">[20]/value</span>. </span>
                <div class="itemgroup info">A list of fields displays when the pipeline is valid for data preview. If the
                    list does not display, you can enter the field path manually.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To use a regular expression as a mask and display the last 4 digits of the
                    credit card number, configure the rest of the properties as follows:</span>
                <div class="itemgroup info">
                    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="task_qbw_d3m_ls__table_ejl_msm_ls" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" width="28.49002849002849%" id="d46622e831">Field Masker Property</th>

                                    <th class="entry" valign="top" width="71.5099715099715%" id="d46622e834">Configuration</th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                                <tr class="row">
                                    <td class="entry" valign="top" width="28.49002849002849%" headers="d46622e831 ">Mask Type</td>

                                    <td class="entry" valign="top" width="71.5099715099715%" headers="d46622e834 ">Regular Expression</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="28.49002849002849%" headers="d46622e831 ">Regular Expression</td>

                                    <td class="entry" valign="top" width="71.5099715099715%" headers="d46622e834 ">
                                        <samp class="ph codeph">(.*)([0-9]{4})</samp></td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="28.49002849002849%" headers="d46622e831 ">Groups to Reveal</td>

                                    <td class="entry" valign="top" width="71.5099715099715%" headers="d46622e834 ">2</td>

                                </tr>

                            </tbody>

                        </table>
</div>

                </div>
            </li>
</ol>

        <div class="section result">Here's the pipeline so far:<p class="p"><img class="image" id="task_qbw_d3m_ls__image_v1y_35q_ps" src="../Graphics/Tutorial-FieldMasker.png" height="357" width="616"></img></p>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_wsj_5tm_ls">
    <h2 class="title topictitle2">Write to the Destination</h2>

    
    <div class="body taskbody"><p class="shortdesc">You can use the Hadoop FS destination to write to HDFS or to a local directory. We'll
        write to a local directory.</p>

        <div class="section context">
            <p class="p">When you configure the Hadoop FS destination, you define the directory template. This
                determines the naming convention for the output directories that are created. Use
                the directory where you want the output files to be written. </p>

        </div>

        <ol class="ol steps" id="task_wsj_5tm_ls__steps_xdd_wwm_ls"><li class="li step stepexpand">
                <span class="ph cmd">Add a <span class="ph uicontrol">Hadoop FS</span> destination to the canvas and and
                    connect it to the Field Masker.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the Properties panel, click the <span class="keyword wintitle">Hadoop FS</span> tab. If you
                    have an HDFS installation, you can configure the stage to write to it. </span>
                <div class="itemgroup info">Or, to use Hadoop FS to write to a local file system, enter the following
                    configuration for the <span class="ph uicontrol">Hadoop FS URI</span> property:
                        <samp class="ph codeph">file:///</samp>.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="keyword wintitle">Output Files</span> tab and configure the following
                    properties. Use the defaults for the rest:</span>
                <div class="itemgroup info">
                    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="task_wsj_5tm_ls__table_kcy_5bn_ls" class="table" frame="border" border="1" rules="all">
                            
                            
                            <thead class="thead" align="left">
                                <tr class="row">
                                    <th class="entry" valign="top" width="29.49852507374631%" id="d46622e953">Hadoop FS Property</th>

                                    <th class="entry" valign="top" width="70.50147492625369%" id="d46622e956">Configuration</th>

                                </tr>

                            </thead>

                            <tbody class="tbody">
                                <tr class="row">
                                    <td class="entry" valign="top" width="29.49852507374631%" headers="d46622e953 ">Data Format</td>

                                    <td class="entry" valign="top" width="70.50147492625369%" headers="d46622e956 ">Delimited</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="29.49852507374631%" headers="d46622e953 ">Files Prefix</td>

                                    <td class="entry" valign="top" width="70.50147492625369%" headers="d46622e956 ">Defines a prefix for output files. <p class="p">By default, the files are prefixed with "SDC" and an expression that
                  returns the <span class="ph">Data
                  Collector</span> ID, but that's more than
                  we need here. </p>
Let's simplify and use "Tutorial_" instead.</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="29.49852507374631%" headers="d46622e953 ">Directory Template</td>

                                    <td class="entry" valign="top" width="70.50147492625369%" headers="d46622e956 ">Use the output directory where you want the files to be
                                        written and optionally include datetime variables to
                                        indicate the frequency at which the files should be rolled
                                        over. <p class="p">For example the following directory rolls the
                                            output file once a year, but works for this tutorial:
                                                <samp class="ph codeph">&lt;output
                                            directory&gt;/${YYYY()}</samp>.</p>
</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="29.49852507374631%" headers="d46622e953 ">Max Records in File</td>

                                    <td class="entry" valign="top" width="70.50147492625369%" headers="d46622e956 ">250000</td>

                                </tr>

                                <tr class="row">
                                    <td class="entry" valign="top" width="29.49852507374631%" headers="d46622e953 ">Max File Size (MB)</td>

                                    <td class="entry" valign="top" width="70.50147492625369%" headers="d46622e956 ">If writing to a local file system, you might lower the
                                        file size to something manageable, like 5 or 1.</td>

                                </tr>

                            </tbody>

                        </table>
</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="keyword wintitle">Delimited</span> tab and configure the following
                    property. Use the defaults for the rest:</span>
                <div class="itemgroup info">
                    <table cellpadding="4" cellspacing="0" summary="" id="task_wsj_5tm_ls__simpletable_jyj_2vq_ps" border="1" class="simpletable"><tr class="sthead">
                            <th valign="bottom" align="left" id="d46622e1038" class="stentry">Delimited Property</th>

                            <th valign="bottom" align="left" id="d46622e1041" class="stentry">Value</th>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1038" class="stentry">Header Line</td>

                            <td valign="top" headers="d46622e1041" class="stentry">With Header Line</td>

                        </tr>
</table>

                </div>
            </li>
</ol>

        <div class="section result">That completes the primary branch:<p class="p"><img class="image" id="task_wsj_5tm_ls__image_svj_rvq_ps" src="../Graphics/Tutorial-HDFS.png" height="75" width="604"></img></p>
<p class="p"> Now, let's go back to the Stream
                Selector and complete the secondary branch.</p>
</div>

    </div>

</div>
<div class="topic task nested1" id="task_wgb_t4p_ms">
    <h2 class="title topictitle2">Add Corresponding Fields with the Expression Evaluator</h2>

    
    <div class="body taskbody"><p class="shortdesc">Use an Expression Editor to add the credit card type fields to the non-credit card
        stream so all records have the same format when written to the destination.</p>

        <div class="section context">
            <p class="p">To do this, let's use data preview to verify how we added the credit card type to the
                records.</p>

        </div>

        <ol class="ol steps" id="task_wgb_t4p_ms__steps_mr4_2pp_ms"><li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="ph uicontrol">Preview</span> icon. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the pipeline, click the <span class="ph uicontrol">Jython Evaluator</span> to view the
                    output of that processor.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Expand the first output record, scroll down, and expand index 21. Note the
                    header and value information, and then click <span class="ph uicontrol">Close
                        Preview</span>.</span>
                <div class="itemgroup info"><img class="image" id="task_wgb_t4p_ms__image_h4c_d4h_4s" src="../Graphics/Tutorial-Exp-JythonPreview.png" height="288" width="700"></img><p class="p">From this, we can see that we need to add a map with an index
                        of 21, as well as the header and value fields.</p>
</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Add an <span class="ph uicontrol">Expression Evaluator</span> processor to the canvas and
                    connect it to default output of the <span class="ph uicontrol">Stream Selector</span>. </span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="keyword wintitle">Expressions</span> tab.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click the <span class="ph uicontrol">Add</span> icon twice and configure the properties as
                    follows:</span>
                <div class="itemgroup info">
                    <table cellpadding="4" cellspacing="0" summary="" id="task_wgb_t4p_ms__simpletable_xdm_rcr_ps" border="1" class="simpletable"><tr class="sthead">
                            <th valign="bottom" align="left" id="d46622e1155" class="stentry">Output Field</th>

                            <th valign="bottom" align="left" id="d46622e1158" class="stentry">Expression</th>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1155" class="stentry">[21]</td>

                            <td valign="top" headers="d46622e1158" class="stentry">${emptyMap()}</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1155" class="stentry">[21]/header</td>

                            <td valign="top" headers="d46622e1158" class="stentry">credit_card_type</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1155" class="stentry">[21]/value</td>

                            <td valign="top" headers="d46622e1158" class="stentry">N/A</td>

                        </tr>
</table>

                </div>
                <div class="itemgroup info">These fields create a map for index 21, a header field with the name
                    credit_card_type, and a value field that indicates the information is not
                    applicable.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To write the data from this branch to the destination and merge the non-credit
                    card data with the credit card data, link the Expression Evaluator to the Hadoop
                    FS destination:</span>
                <div class="itemgroup info"><img class="image" id="task_wgb_t4p_ms__image_adv_r2r_ps" src="../Graphics/Tutorial-Expression.png" height="365" width="677"></img></div>
            </li>
</ol>

    </div>

</div>
<div class="topic task nested1" id="task_ets_dkj_ps">
    <h2 class="title topictitle2">Create a Data Rule and Alert</h2>

    
    <div class="body taskbody"><p class="shortdesc">The basic pipeline is complete. Now let's add a data rule and alert. Data rules are
        user-defined rules used to inspect data moving between two stages. </p>

        <div class="section context">
            <p class="p">Data rules and alerts require a detailed understanding of the data passing through
                the pipeline. For more general pipeline monitoring information, you can use metric
                rules and alerts.</p>

            <p class="p">The script in the Jython Evaluator creates error records for credit card transactions
                without credit card numbers. We can create a data rule and alert to let us know when
                the record count reaches a specified threshold. </p>

            <p class="p">We'll use an expression with the record:value() function to identify when the credit
                card number field, [20]/value, is null. The record:value() function returns the data
                in the specified field. </p>

        </div>

        <ol class="ol steps" id="task_ets_dkj_ps__steps_cw5_qqj_ps"><li class="li step stepexpand">
                <span class="ph cmd">Select the link between the <span class="ph uicontrol">Stream Selector</span> and the
                        <span class="ph uicontrol">Jython Evaluator</span>.</span>
                <div class="itemgroup info">The <span class="keyword wintitle">Data Rules</span> tab displays in the Preview panel. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click <span class="ph uicontrol">Add</span>.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">In the <span class="keyword wintitle">Data Rule</span> dialog box, configure the following
                    properties:</span>
                <div class="itemgroup info">
                    <table cellpadding="4" cellspacing="0" summary="" id="task_ets_dkj_ps__simpletable_z34_ctj_ps" border="1" class="simpletable"><tr class="sthead">
                            <th valign="bottom" align="left" id="d46622e1274" class="stentry">Data Rule Property</th>

                            <th valign="bottom" align="left" id="d46622e1277" class="stentry">Description</th>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1274" class="stentry">Label</td>

                            <td valign="top" headers="d46622e1277" class="stentry">Missing Card Numbers</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1274" class="stentry">Condition</td>

                            <td valign="top" headers="d46622e1277" class="stentry">${record:value("[20]/value") == ""}</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1274" class="stentry">Sampling Percentage</td>

                            <td valign="top" headers="d46622e1277" class="stentry">20</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1274" class="stentry">Alert Text</td>

                            <td valign="top" headers="d46622e1277" class="stentry">Over 10 missing credit card numbers!</td>

                        </tr>
<tr class="strow">
                            <td valign="top" headers="d46622e1274" class="stentry">Threshold Value</td>

                            <td valign="top" headers="d46622e1277" class="stentry">10</td>

                        </tr>
</table>

                    <div class="note note"><span class="notetitle">Note:</span> With a larger data set, a smaller sampling percentage might be
                        appropriate, but for the purposes of this tutorial, we'll use 20.</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Click <span class="ph uicontrol">Save</span>.</span>
                <div class="itemgroup info">The rule displays in the data rule list. </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">To enable the data rule and alert, click <span class="ph uicontrol">Active</span>. </span>
            </li>
</ol>

    </div>

</div>
<div class="topic task nested1" id="task_m21_dyj_ps">
    <h2 class="title topictitle2">Run the Basic Pipeline</h2>

    
    <div class="body taskbody"><p class="shortdesc">Now that the basic pipeline is complete, you can start it by clicking the
            <span class="ph uicontrol">Start</span> icon.</p>

        <div class="section context">
            <p class="p">The console enters Monitor mode and shows summary statistics in the Monitor panel.
                Odds are good the data alert has triggered, displaying a pop up message and a
                notification:</p>

            <p class="p"><img class="image" id="task_m21_dyj_ps__image_gc3_vyr_ps" src="../Graphics/Tutorial-RunPipeline.png" height="563" width="759"></img></p>

            <p class="p">You can close the message and explore the information available in the Monitor
                panel.</p>

            <p class="p">Note that when you select an unused part of the canvas, the Monitor panel displays
                monitoring information for the pipeline. When you select a stage, it displays
                information for the stage. </p>

            <p class="p">The Jython Evaluator shows 40 error records. Click the error records count to see the
                list of cached error records and related error messages. </p>

            <p class="p">You can also select the red Alert icon to view information about the data alert and
                view the error records associated with the data alert.</p>

            <p class="p">To continue with the extended tutorial, stop the pipeline. </p>

            <p class="p">If you like, you can use data preview to step through the pipeline to review how each
                stage processes the data. But if you hang in there, you can do it with us at the end
                of the extended tutorial. </p>

        </div>

    </div>

</div>
</div>
<div class="navfooter"><!---->
<span class="navparent"><a class="link" href="../Tutorial/Tutorial-title.html" title="Data Collector Tutorial"><span class="navheader_label">Parent topic</span><span class="navheader_separator">: </span><span class="navheader_linktext">Data Collector Tutorial</span></a></span>  </div><div class="footer"><div> </div><!--  <a href="http://creativecommons.org/licenses/by-nc/4.0/legalcode">CC BY-NC 4.0.</a> StreamSets, 2015. --></div>
</body>
</html>